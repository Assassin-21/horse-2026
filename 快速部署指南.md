# 🚀 激活码服务端 - 快速部署指南

## 📋 前置准备

- [ ] Node.js 已安装（用于本地测试）
- [ ] GitHub 账号（用于登录 Vercel）
- [ ] JSONBin.io 账号（免费注册）

---

## 第一步：注册 JSONBin.io（5分钟）

1. 访问 https://jsonbin.io
2. 点击右上角 **"Sign Up"**（可用 GitHub 登录）
3. 登录后，点击右上角头像 → **"API Keys"**
4. 复制你的 **Master Key**（类似 `$2a$10$xxxxx`）
   - ⚠️ 这个 Key 很重要，保存好！

---

## 第二步：创建 JSONBin 存储（3分钟）

1. 在 JSONBin.io 首页，点击 **"Create a Bin"**
2. 打开 `codes_2025-12-09.json` 文件
3. 复制文件中的 JSON 内容，粘贴到 Bin 中
4. 点击 **"Create"**
5. 复制 **Bin ID**（URL 中的一串字符，如 `5f9a8b7c6d5e4f3a2b1c0d9e`）
   - ⚠️ 这个 ID 也很重要，保存好！

---

## 第三步：部署到 Vercel（10分钟）

### 方法一：通过网页部署（推荐）

1. 访问 https://vercel.com
2. 用 GitHub 账号登录
3. 点击 **"Add New Project"**
4. 选择 **"Import Git Repository"** 或 **"Upload"**
   - 如果上传：直接拖拽 `激活码服务端` 文件夹
5. 项目设置：
   - **Framework Preset**: Other
   - **Root Directory**: `./`（默认）
6. 点击 **"Environment Variables"**，添加两个变量：
   - `JSONBIN_BIN_ID` = 你的 Bin ID
   - `JSONBIN_API_KEY` = 你的 Master Key
7. 点击 **"Deploy"**
8. 等待部署完成（约1-2分钟）
9. 复制部署后的域名（如 `machao-xxx.vercel.app`）

### 方法二：通过命令行部署

```bash
# 1. 安装 Vercel CLI
npm install -g vercel

# 2. 登录
vercel login

# 3. 进入项目目录
cd 激活码服务端

# 4. 部署
vercel

# 5. 设置环境变量
vercel env add JSONBIN_BIN_ID
# 输入你的 Bin ID

vercel env add JSONBIN_API_KEY
# 输入你的 Master Key

# 6. 重新部署到生产环境
vercel --prod
```

---

## 第四步：测试 API（2分钟）

### 方法一：使用测试页面

1. 打开 `test-api.html` 文件（用浏览器打开）
2. 在 **API 地址** 输入框中输入你的 Vercel 域名
3. 点击 **"快速测试：验证"** 按钮
4. 应该看到 `success: true` 的响应

### 方法二：使用命令行

```bash
# 安装 node-fetch（如果需要）
npm install node-fetch

# 运行测试
node test-api.js https://你的域名.vercel.app
```

### 方法三：使用 curl

```bash
curl -X POST https://你的域名.vercel.app/api/verify \
  -H "Content-Type: application/json" \
  -d '{"code": "HORSE-2026-L273-MXR5", "action": "verify"}'
```

---

## 第五步：配置插件

部署成功后，更新插件代码：

1. 打开 `马钞预约助手\浏览器插件版\popup.js`
2. 找到这一行：
   ```javascript
   const ACTIVATION_API = 'https://your-project.vercel.app/api/verify';
   ```
3. 改为你的实际 API 地址：
   ```javascript
   const ACTIVATION_API = 'https://你的域名.vercel.app/api/verify';
   ```
4. 将 `SKIP_ACTIVATION` 改为 `false`：
   ```javascript
   const SKIP_ACTIVATION = false;
   ```
5. 重新加载插件

---

## ✅ 验证清单

- [ ] JSONBin.io 账号已注册
- [ ] Master Key 已保存
- [ ] Bin 已创建，数据已导入
- [ ] Bin ID 已保存
- [ ] Vercel 项目已部署
- [ ] 环境变量已配置
- [ ] API 测试通过
- [ ] 插件代码已更新

---

## 🔧 常见问题

### Q: Vercel 部署失败？

**A:** 检查：
1. `package.json` 是否存在
2. `vercel.json` 配置是否正确
3. 环境变量是否已设置

### Q: API 返回 500 错误？

**A:** 检查：
1. 环境变量是否正确设置
2. JSONBin 的 Bin ID 和 API Key 是否正确
3. Vercel 日志（在 Vercel 控制台查看）

### Q: 如何查看已使用的激活码？

**A:** 
1. 登录 JSONBin.io
2. 打开你的 Bin
3. 查看 `usedCodes` 字段

### Q: 如何添加新的激活码？

**A:**
1. 运行 `node generate-codes.js 数量`
2. 打开生成的 JSON 文件
3. 复制新的 `codes` 数据
4. 在 JSONBin.io 中更新 Bin 内容

---

## 📞 测试激活码

部署完成后，可以使用以下激活码测试：

```
HORSE-2026-L273-MXR5
HORSE-2026-T3W4-PA9P
HORSE-2026-7QB9-2GEF
```

（更多激活码见 `codes_list_2025-12-09.txt`）

---

**部署完成后，记得更新插件代码中的 API 地址！** 🎉


# 🚀 激活码服务端 - 详细部署教程（新手版）

> 本教程适合第一次使用 JSONBin.io 和 Vercel 的用户

---

## 📋 准备工作

- [ ] 一个邮箱账号（用于注册）
- [ ] GitHub 账号（可选，但推荐，可以快速登录）
- [ ] 浏览器（Chrome/Edge 推荐）

---

## 第一部分：注册 JSONBin.io（5分钟）

### 步骤 1：访问网站

1. 打开浏览器，访问：**https://jsonbin.io**
2. 点击右上角的 **"Create Account"** 或 **"Sign Up"** 按钮

### 步骤 2：注册账号

**方式一：使用 GitHub 登录（推荐）**
- 点击 **"Sign in with GitHub"** 按钮
- 授权 JSONBin.io 访问你的 GitHub
- 完成注册

**方式二：邮箱注册**
- 输入邮箱和密码
- 点击 **"Create Account"**
- 去邮箱验证（如果需要）

### 步骤 3：获取 Master Key

1. 登录后，点击右上角的 **头像图标**（或你的用户名）
2. 在下拉菜单中点击 **"API Keys"** 或 **"Settings"**
3. 找到 **"Master Key"** 或 **"X-Master-Key"**
4. 点击 **"Show"** 或 **"Reveal"** 显示密钥
5. **复制这个 Key**（类似 `$2a$10$xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`）
   - ⚠️ **重要：** 这个 Key 只显示一次，请立即保存到安全的地方！

**保存位置建议：**
- 创建一个文本文件保存
- 或记录在密码管理器中

---

## 第二部分：创建 Bin 并导入数据（5分钟）

### 步骤 1：创建新 Bin

1. 在 JSONBin.io 首页，点击 **"Create a Bin"** 或 **"New Bin"** 按钮
2. 会打开一个编辑器界面

### 步骤 2：导入激活码数据

1. 打开文件：`激活码服务端\codes_2025-12-09.json`
2. **全选**文件内容（Ctrl+A）
3. **复制**（Ctrl+C）
4. 回到 JSONBin.io 编辑器
5. **删除**编辑器中的默认内容 `{}`
6. **粘贴**（Ctrl+V）刚才复制的 JSON 数据
7. 点击右上角的 **"Save"** 或 **"Create"** 按钮

### 步骤 3：获取 Bin ID

1. 保存成功后，浏览器地址栏会变成类似：
   ```
   https://jsonbin.io/app/bins/5f9a8b7c6d5e4f3a2b1c0d9e
   ```
2. **Bin ID 就是 URL 中 `/bins/` 后面的那一串字符**
   - 例如：`5f9a8b7c6d5e4f3a2b1c0d9e`
3. **复制这个 Bin ID**，保存好

**验证数据格式：**
你的 Bin 内容应该类似这样：
```json
{
  "codes": {
    "HORSE-2026-L273-MXR5": { ... },
    "HORSE-2026-T3W4-PA9P": { ... }
  },
  "usedCodes": {},
  "createdAt": "...",
  "totalCount": 20
}
```

---

## 第三部分：部署到 Vercel（15分钟）

### 步骤 1：访问 Vercel

1. 打开浏览器，访问：**https://vercel.com**
2. 点击右上角的 **"Sign Up"** 或 **"Log In"**

### 步骤 2：登录 Vercel

**推荐：使用 GitHub 登录**
- 点击 **"Continue with GitHub"**
- 授权 Vercel 访问你的 GitHub
- 完成登录

**或：邮箱注册**
- 输入邮箱和密码
- 完成注册

### 步骤 3：创建新项目

1. 登录后，点击 **"Add New Project"** 或 **"New Project"** 按钮
2. 你会看到两个选项：
   - **"Import Git Repository"**（从 Git 导入）
   - **"Upload"** 或 **"Deploy"**（直接上传）

**选择：直接上传（推荐新手）**

### 步骤 4：上传项目文件夹

**方法一：拖拽上传（最简单）**

1. 打开文件管理器，找到 `激活码服务端` 文件夹
2. **直接拖拽**整个文件夹到 Vercel 页面的上传区域
3. 等待上传完成

**方法二：点击上传**

1. 点击 **"Upload"** 或 **"Browse"** 按钮
2. 选择 `激活码服务端` 文件夹
3. 等待上传完成

### 步骤 5：配置项目

上传后，Vercel 会显示项目配置页面：

1. **Project Name**（项目名称）
   - 可以改为：`machao-activation` 或保持默认

2. **Framework Preset**
   - 选择：**"Other"** 或 **"Other"**

3. **Root Directory**
   - 保持默认：`./`（不要改）

4. **Build and Output Settings**
   - 保持默认即可

### 步骤 6：配置环境变量（重要！）

在配置页面下方，找到 **"Environment Variables"** 部分：

1. 点击 **"Add"** 或 **"Add Environment Variable"** 按钮

2. **添加第一个变量：**
   - **Name（名称）：** `JSONBIN_BIN_ID`
   - **Value（值）：** 粘贴你之前保存的 Bin ID
   - **Environment（环境）：** 选择 **"Production, Preview, Development"**（全选）
   - 点击 **"Add"**

3. **添加第二个变量：**
   - 再次点击 **"Add"**
   - **Name（名称）：** `JSONBIN_API_KEY`
   - **Value（值）：** 粘贴你之前保存的 Master Key
   - **Environment（环境）：** 选择 **"Production, Preview, Development"**（全选）
   - 点击 **"Add"**

**验证：**
- 应该看到两个环境变量：
  - `JSONBIN_BIN_ID` = 你的 Bin ID
  - `JSONBIN_API_KEY` = 你的 Master Key

### 步骤 7：部署

1. 确认环境变量已添加
2. 点击页面底部的 **"Deploy"** 按钮
3. 等待部署完成（约 1-2 分钟）
   - 会显示部署进度
   - 完成后会显示 **"Congratulations!"**

### 步骤 8：获取部署域名

部署成功后：

1. 在项目页面，你会看到一个 **域名**，类似：
   ```
   machao-activation-xxx.vercel.app
   ```
2. **复制这个域名**，这就是你的 API 地址
3. 完整 API 地址是：
   ```
   https://你的域名.vercel.app/api/verify
   ```

---

## 第四部分：测试 API（3分钟）

### 方法一：使用测试页面（推荐）

1. 打开文件：`激活码服务端\test-api.html`
   - 可以直接双击文件，或用浏览器打开

2. 在 **"API 地址"** 输入框中：
   - 输入你的 Vercel 域名（不需要加 `/api/verify`）
   - 例如：`machao-activation-xxx.vercel.app`

3. 在 **"激活码"** 输入框中：
   - 输入测试激活码：`HORSE-2026-L273-MXR5`

4. 点击 **"🚀 测试 API"** 按钮

5. **预期结果：**
   ```json
   {
     "success": true,
     "message": "激活码有效",
     "code": "VALID"
   }
   ```

6. **测试激活：**
   - 操作选择：**"激活"**
   - 再次点击测试
   - 应该看到：`"code": "ACTIVATED"`

### 方法二：使用浏览器直接测试

1. 打开浏览器，访问：
   ```
   https://你的域名.vercel.app/api/verify
   ```
   - 应该看到错误（因为需要 POST 请求），这是正常的

2. 打开浏览器开发者工具（F12）
3. 切换到 **"Console"** 标签
4. 输入以下代码并回车：

```javascript
fetch('https://你的域名.vercel.app/api/verify', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    code: 'HORSE-2026-L273-MXR5',
    action: 'verify'
  })
}).then(r => r.json()).then(console.log)
```

5. 应该看到返回结果

---

## 第五部分：更新插件代码（2分钟）

### 步骤 1：修改 API 地址

1. 打开文件：`马钞预约助手\浏览器插件版\popup.js`
2. 找到第 15 行：
   ```javascript
   const ACTIVATION_API = 'https://your-project.vercel.app/api/verify';
   ```
3. 改为你的实际 API 地址：
   ```javascript
   const ACTIVATION_API = 'https://你的域名.vercel.app/api/verify';
   ```
   - 例如：`const ACTIVATION_API = 'https://machao-activation-xxx.vercel.app/api/verify';`

### 步骤 2：关闭测试模式

1. 找到第 18 行：
   ```javascript
   const SKIP_ACTIVATION = true;
   ```
2. 改为：
   ```javascript
   const SKIP_ACTIVATION = false;
   ```

### 步骤 3：重新加载插件

1. 打开 Chrome，访问 `chrome://extensions/`
2. 找到"马钞预约助手"
3. 点击 **刷新按钮** 🔄
4. 打开插件，应该会显示激活界面

### 步骤 4：测试激活

1. 在激活码输入框中输入：`HORSE-2026-L273-MXR5`
2. 点击 **"激活"** 按钮
3. 应该看到 **"🎉 激活成功！"**
4. 激活界面消失，显示 **"✅ 已激活"** 标记

---

## ✅ 验证清单

完成以下检查：

- [ ] JSONBin.io 账号已注册
- [ ] Master Key 已保存
- [ ] Bin 已创建，数据已导入
- [ ] Bin ID 已保存
- [ ] Vercel 账号已注册
- [ ] 项目已上传到 Vercel
- [ ] 环境变量已配置（JSONBIN_BIN_ID 和 JSONBIN_API_KEY）
- [ ] 项目已部署成功
- [ ] 获取了部署域名
- [ ] API 测试通过（使用 test-api.html）
- [ ] 插件代码已更新（API 地址和 SKIP_ACTIVATION）
- [ ] 插件激活功能测试通过

---

## 🔧 常见问题

### Q1: JSONBin.io 找不到 API Keys？

**A:** 
- 点击右上角头像 → **"Settings"** → **"API Keys"**
- 或者直接访问：https://jsonbin.io/app/settings/api-keys

### Q2: Vercel 上传后找不到环境变量配置？

**A:**
- 在项目配置页面，向下滚动找到 **"Environment Variables"**
- 或者在项目部署后，进入项目 → **"Settings"** → **"Environment Variables"**

### Q3: Vercel 部署失败？

**A:** 检查：
1. `package.json` 文件是否存在
2. `vercel.json` 文件是否存在
3. 文件结构是否正确

### Q4: API 返回 500 错误？

**A:** 检查：
1. 环境变量是否正确设置
2. Bin ID 是否正确（不要有多余空格）
3. Master Key 是否正确
4. 在 Vercel 项目页面 → **"Deployments"** → 点击最新的部署 → **"Functions"** → 查看日志

### Q5: 如何查看 Vercel 部署日志？

**A:**
1. 进入 Vercel 项目页面
2. 点击 **"Deployments"** 标签
3. 点击最新的部署记录
4. 查看 **"Build Logs"** 或 **"Function Logs"**

### Q6: 如何更新激活码数据？

**A:**
1. 运行 `node generate-codes.js 数量` 生成新的激活码
2. 打开 JSONBin.io，编辑你的 Bin
3. 更新 `codes` 字段
4. 保存即可（Vercel API 会自动读取最新数据）

---

## 📞 需要帮助？

如果遇到问题：
1. 检查浏览器控制台（F12）的错误信息
2. 查看 Vercel 部署日志
3. 确认环境变量是否正确
4. 确认 JSONBin 数据格式是否正确

---

**完成部署后，记得测试 API 功能！** 🎉


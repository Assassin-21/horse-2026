# 🐴 马钞预约助手 - 激活码服务端部署说明

## 📋 架构说明

```
浏览器插件 ──→ Vercel API ──→ JSONBin.io（存储激活码）
```

## 🚀 部署步骤

### 第一步：注册 JSONBin.io（免费存储）

1. 访问 https://jsonbin.io
2. 点击 "Sign Up" 注册账号（可用 GitHub 登录）
3. 登录后，点击右上角头像 → "API Keys"
4. 复制你的 **Master Key**（类似 `$2a$10$xxxxx`）
5. 记下这个 Key，后面要用

### 第二步：生成激活码

在命令行中运行：

```bash
cd 激活码服务端
node generate-codes.js 50
```

这会生成 50 个激活码，并输出 JSON 数据。

### 第三步：创建 JSONBin 存储

1. 在 JSONBin.io 首页，点击 "Create a Bin"
2. 把第二步生成的 JSON 数据粘贴进去
3. 点击 "Create"
4. 复制 Bin ID（URL 中的一串字符，如 `5f9a8b7c6d5e4f3a2b1c0d9e`）

### 第四步：部署到 Vercel

1. 注册 Vercel：https://vercel.com（可用 GitHub 登录）

2. 安装 Vercel CLI：
   ```bash
   npm install -g vercel
   ```

3. 登录 Vercel：
   ```bash
   vercel login
   ```

4. 部署项目：
   ```bash
   cd 激活码服务端
   vercel
   ```
   按提示操作，选择默认选项即可。

5. 设置环境变量：
   ```bash
   vercel env add JSONBIN_BIN_ID
   # 输入你的 Bin ID
   
   vercel env add JSONBIN_API_KEY
   # 输入你的 Master Key
   ```

6. 重新部署：
   ```bash
   vercel --prod
   ```

### 第五步：测试 API

部署成功后，Vercel 会给你一个域名，如 `machao-xxx.vercel.app`

测试激活码验证：

```bash
curl -X POST https://你的域名.vercel.app/api/verify \
  -H "Content-Type: application/json" \
  -d '{"code": "HORSE-2026-XXXX-XXXX", "action": "activate"}'
```

### 第六步：配置插件

在插件代码中设置你的 API 地址：

```javascript
const API_URL = 'https://你的域名.vercel.app/api/verify';
```

---

## 📊 API 说明

### 验证/激活接口

**请求：**
```
POST /api/verify
Content-Type: application/json

{
  "code": "HORSE-2026-XXXX-XXXX",
  "action": "activate",  // "activate" 或 "verify"
  "deviceId": "用户设备ID"  // 可选，用于绑定设备
}
```

**响应：**
```json
{
  "success": true,
  "message": "激活成功！",
  "code": "ACTIVATED"
}
```

**错误码：**
- `INVALID_CODE` - 激活码无效
- `ALREADY_USED` - 激活码已被使用
- `ALREADY_ACTIVATED` - 已在此设备激活过

---

## 💰 费用说明

| 服务 | 免费额度 | 超出费用 |
|------|----------|----------|
| Vercel | 每月 10 万次请求 | $20/100万次 |
| JSONBin.io | 1 万次请求/月 | 付费升级 |

对于小规模使用（几百个用户），完全免费够用。

---

## 🔧 常见问题

### Q: Vercel 在国内能访问吗？
A: 大部分地区可以，但不是 100%。如果有问题，考虑使用阿里云。

### Q: 如何添加新的激活码？
A: 重新运行 `node generate-codes.js`，然后手动更新 JSONBin 中的数据。

### Q: 如何查看已使用的激活码？
A: 登录 JSONBin.io，查看你的 Bin 内容。

---

## 📁 文件说明

```
激活码服务端/
├── api/
│   └── verify.js      # 验证 API
├── package.json       # 项目配置
├── vercel.json        # Vercel 配置
├── generate-codes.js  # 激活码生成工具
└── 部署说明.md        # 本文件
```

